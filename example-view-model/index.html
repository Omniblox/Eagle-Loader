<!DOCTYPE html>
<html>

<head></head>

<body>

<script src="../lib/three.js"></script>
<script src="../lib/connector.js"></script>
<script src="../src/eagle-brd-renderer.js"></script>
<script>

	// Load and initiate process
	var brd, src,
		camera, renderer, scene,
		xhttp = new XMLHttpRequest(),
		showMesh = function( brd ) {

			var light, lightRig,
				zoom = 1.5;

			// Init view
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(
				75, window.innerWidth / window.innerHeight, 100, 10000 );
			camera.position.z = ( brd.width + brd.height ) / zoom;
			renderer = new THREE.WebGLRenderer();
			renderer.setSize( 640, 480 );
			renderer.setClearColor( 0x000000, 1);
			document.body.appendChild( renderer.domElement );

			// View mesh
			scene.add( brd.root );

			// Light the mesh
			lightRig = new THREE.Object3D();
			scene.add( lightRig );
			light = new THREE.PointLight( 0xddeeff, 0.5, 0 );
			light.position.set( 400, -800, 1600 );
			lightRig.add( light );
			light = new THREE.PointLight( 0xffeedd, 0.5, 0 );
			light.position.set( -400, 800, 1600 );
			lightRig.add( light );
			light = new THREE.PointLight( 0x8888dd, 0.5, 0 );
			light.position.set( -800, 0, -400 );
			lightRig.add( light );
			light = new THREE.PointLight( 0xdd8888, 0.5, 0 );
			light.position.set( 800, 0, -400 );
			lightRig.add( light );

			var animate = function() {
				var now = Date.now();

				requestAnimationFrame( animate );

				brd.root.rotation.x =
					0.2 * Math.sin( now * 0.00013 );
				// brd.root.rotation.y =
				// 	0.4 * Math.sin( now * 0.00022 ) + Math.PI / 2;
				brd.root.rotation.z =
					0.2 * Math.sin( now * 0.00031 );

				brd.root.rotation.y = now * 0.00037;

				renderer.render( scene, camera );
			}

			// Commence rendering
			animate();
		};

	//
	// Toggle board to render here
	//
	// src = "../brd/adafruit-cc3000-breakout.brd";
	//src = "../brd/adafruit-flora-mainboard-2.brd";
	// src = "../brd/adafruit-pro-trinket-3v3.brd";
	// src = "../brd/adafruit-pro-trinket-5v0.brd";
	src = "../brd/feather.brd";

	xhttp.onreadystatechange = function() {
		if ( xhttp.readyState === 4 && xhttp.status === 200 ) {

			var parser = new DOMParser();
      var xmlDoc = parser.parseFromString(xhttp.responseText,"text/xml");
			brd = new EagleBrdRenderer( xmlDoc, {colors: {solderMask: "rgb( 0, 0, 0 )"}} );

			showMesh( brd );
		}
	};

	xhttp.open( "GET", src, true );
	xhttp.send();
</script>

</body>

</html>
